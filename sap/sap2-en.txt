1. Introduction
---------------
The SAP archiving system, designed by Alexander Pukall, is the tool used
by Thomson emulators to handle flexibly and securely 3 "5 or 5" 25 disks
formatted Thomson. The main idea is to reproduce Thomson physical disks
as files "images", storable on hard disk and directly readable by emulators:
all operations read / write are thus performed on these images and not on
the original disks.

This system allows to easily copy disks, to spread any digital medium and
ultimately ensures the preservation of their data beyond the life of the
physical medium.

The utility SAP is the bridge to make the connection between the two
storage modes. The original version was written by Alexander Pukall
itself, the extended version SAP2 shown below, available for
MSDOS and Linux, includes all features.


2. How to get it ?
------------------
By downloading it at the web page:
http://sourceforge.net/projects/teoemulator/?source=directory


3. How the Program Works
------------------------
SAP2 can work in two modes: if no argument is passed on the command line,
it enters interactive mode and offers a menu of commands available, if at
least one argument is passed to it on the command line, it enters in batch
mode and decodes the argument to execute the specified command.


4. Program commands in interactive mode
--------------------------------------------
The commands fall into three categories: Transfer TO -> PC PC transfer -> TO
and other commands.

   4.1 TO--> PC transfer
   ---------------------
   Command 1: Viewing the contents of a Thomson floppy
     This command can be useful *before* starting the process archive
     itself: it displays the directory of a 3"5 or 5"25 disc formatted
     Thomson inserted in one of drives (it has the same effect as the DIR
     command of BASIC).

   Command 2: Create an empty SAP archive
     This command can be executed without Thomson floppy.
     It creates an empty, formatted SAP archive (the same as the BASIC
     command DSKINI on a newly created archive SAP), either 3"5 type (80
     tracks, 320 kb) or 5"25 DD type (40 tracks, 160 kb) or even 5"25 SD
     (40 tracks, 80 kb).

   Command 3: Archive a Thomson floppy to a SAP archive
     This command is the main archiving command: she reads the contents of
     the 3"5 or 5"25 floppy inserted in a PC floppy drive and transfers it
     as a SAP archive on the PC hard disk. It detects bad sectors and
     activates the mechanism that SAP format defines in this case.
     
     
   4.2 PC--> TO transfer
   ---------------------
   Command 4: View the contents of a SAP archive
     This command can be useful *before* starting the unpack process
     itself: it displays the directory of the specified SAP archive.

   Command 5: Formatting a 3"5 or 5"25 Thomson floppy
     Unpacking (command 6) a SAP archive to a 3"5 or 5"25 floppy can
     be achieved only if the disk is pre-formatted Thomson. This
     command allows to apply this format to a 3"5 or 5"25 floppy
     inserted in one of the PC floppy drives; if the disk is a 3"5 -
     1.44 MB floppy, it is necessary to obstruct the high-capacity
     hole (both sides) with a piece of tape.

   Command 6: Unpacking the SAP archive to a Thomson floppy disk
     This command is the true command of unpacking: it reads the
     contents of a SAP archive and writes it to the 3"5 or 5"25
     formatted Thomson floppy inserted in a PC floppy drive.
     Caution: (see Order 5) the floppy must be Thomson pre-formatted.


   4.3 Other commands
   ------------------
   Control 7: Quit
     As its name doesn't suggest it ;-), it allows to exit the program.
     
     
5. Program commands in batch mode
---------------------------------
One of the following must be passed to SAP2 as the first argument:

  -h, --help
                    display help.
                    ex:  sap2 --help

  -v, --version
                    display the program version.
                    ex:  sap2 --version

  -t, --list archive
                    display the directory of the SAP archive.
                    archive: full name of the SAP archive
                    ex:  sap2 --list foo.sap
                    [see command 4 of interactive mode]

  -p, --pack archive drive [density]
                    archives a Thomson floppy to a SAP archive. If the
                    drive is a 5"25, the density can be specified.
                    archive: full name of the SAP archive
                    drive : 0 = drive A head 0
                            1 = drive A head 1
                            2 = drive B head 0
                            3 = drive B head 1
                    density : 1 = simple density
                              2 = double density (default)
                    ex:  sap2 --pack foo.sap 0
                    [see command 3 of interactive mode]

  -u, --unpack archive drive [density]
                    unarchives a SAP archive. If the drive is a 5"25, the
                    density can be specified.
                    archive: full name of the SAP archive
                    drive : 0 = drive A head 0
                            1 = drive A head 1
                            2 = drive B head 0
                            3 = drive B head 1
                    density : 1 = simple density
                              2 = double density (default)
                    ex:  sap2 --unpack foo.sap 0
                    [see command 6 of interactive mode]

  -c, --create archive [nb of tracks] [density]
                    create a SAP archive.
                    archive: full name of the SAP archive
                    nb_of_tracks : 40 or 80 (default 80)
                    density : 1 = simple density
                              2 = double density (default)
                    ex:  sap2 --create foo.sap
                         sap2 --create foo.sap 40
                    [see command 2 of interactive mode]

  -d, --dir drive [density]
                    display the directory of the formatted Thomson floppy disk
                    inserted in the floppy drive. If the drive is a 5"25, the
                    density can be specified.
                    drive : 0 = drive A head 0
                            1 = drive A head 1
                            2 = drive B head 0
                            3 = drive B head 1
                    density : 1 = simple density
                              2 = double density (default)
                    ex:  sap2 --dir 0
                    [see command 1 of interactive mode]

  -f, --format drive [density] [interleave]
                    formats the 3"5 or 5"25 floppy disk inserted in the floppy
                    drive. If the drive is a 5"25, the density can be specified.
                    drive : 0 = drive A head 0
                            1 = drive A head 1
                            2 = drive B head 0
                            3 = drive B head 1
                    density : 1 = simple density
                              2 = double density (default)
                    interleave : 1 to 15 (default 7)
                    ex:  sap2 --format 0 6
                         sap2 --format 1
                    [see command 5 of interactive mode]


6. Known problems
-------------------
- MSDOS version can run on Windows 95 and 98; however, especially if an
  anti-virus software is running in the background, it may be necessary to
  restart the computer and log on pure MS-DOS.
- The MSDOS version of SAP does not archive or unarchive with the head 1 of
  a Thomson floppy disk, it is ultimately impossible due to an incompatibility
  between the PC BIOS and DOS TO. In contrary, Linux is not affected by this
  problem.
- The MSDOS version of SAP does not provide access to floppies 5 "25 single
  density, this is still a definite impossibility due to PC BIOS limitations.
  In contrary, Linux is not affected by this problem.
- MSDOS may no longer reformat a Thomson formatted floppy to a standard format.


7. Conclusion
-------------

I hope this version of SAP will come up to your expectations, please let me
know your comments and suggestions.


Eric Botcazou
e-mail: <ebotcazou@libertysurf.fr>
