<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<title>Teo</title>
<link rel="stylesheet" type="text/css" href="doc.css">
</head>
<body>
<table width="100%"><tr><td>

<p>[<a href="indexfr.htm">Page d'accueil</a>][<a href="libsapen.htm">Page in English</a>]</p>

<h3>LibSAP</h3>

<p>LibSAP est une librarie de manipulation des archives SAP &eacute;crite en ANSI C. Elle fournit &agrave; la fois des routines de manipulation bas-niveau des archives SAP consid&eacute;r&eacute;es comme format physique (images de disquettes) et des routines de manipulation haut-niveau des archives SAP consid&eacute;r&eacute;es comme format logique (compatible avec le DOS BASIC Thomson).</p>

<ul>
<li><a href="#open_archive">Ouverture d'une archive SAP</a><br></li>
<li><a href="#create_archive">Cr&eacute;ation d'une archive SAP</a><br></li>
<li><a href="#close_archive">Fermeture d'une archive SAP</a><br></li>
<li><a href="#fill_archive">Remplissage une archive SAP</a><br></li>
<li><a href="#read_sector">Lecture d'un secteur SAP</a><br></li>
<li><a href="#read_sectors">Lecture d'une s&eacute;rie de secteurs SAP</a><br></li>
<li><a href="#write_sector">Ecriture d'un secteur SAP</a><br></li>
<li><a href="#write_sectors">Ecriture d'une s&eacute;rie de secteurs SAP</a><br></li>
<li><a href="#format_archive">Formatage d'une archive SAP</a><br></li>
<li><a href="#list_archive">Récup&eacute;ration d'un répertoire SAP</a><br></li>
<li><a href="#add_file">Ajout d'un fichier &agrave; l'archive SAP</a><br></li>
<li><a href="#delete_file">Effacement de fichier(s) de l'archive SAP</a><br></li>
<li><a href="#extract_file">Extraction de fichier(s) de l'archive SAP</a><br></li>
<li><a href="#read_informations">Lecture des informations de fichier</a></li>
</ul>

<h5>Ouverture d'une archive SAP<a name="open_archive"></a></h5>

<p><strong>sapID sap_OpenArchive(const char filename[], int *format);</strong><br>
<span style="padding-left:30px"><em>filename : nom de l'archive SAP</em></span><br>
<span style="padding-left:30px"><em>format : retour du format de l'archive SAP (sap_FORMAT1 ou sap_FORMAT2)</em></span><br><br>
Retourne l'identificateur de l'archive SAP. En cas d'erreur, <code>sap_ERROR</code> est retourn&eacute; et <code>sap_errno</code> contient l'un des codes d'erreur suivants:<br>
<code>SAP_ETOOMANY</code> : trop d'archives SAP sont ouvertes simultan&eacute;ment.<br>
<code>SAP_ENOENT</code> : l'archive SAP sp&eacute;cifi&eacute;e n'existe pas.<br>
<code>SAP_EBADF</code> : le fichier sp&eacute;cifi&eacute; n'est pas une archive SAP.</p>

<h5>Cr&eacute;ation d'une archive SAP<a name="create_archive"></a></h5>

<p><strong>sapID sap_CreateArchive(const char filename[], int format);</strong><br>
<span style="padding-left:30px"><em>filename : nom de l'archive SAP</em></span><br>
<span style="padding-left:30px"><em>format : format de l'archive SAP (sap_FORMAT1 ou sap_FORMAT2)</em></span><br><br>
Retourne l'identificateur de l'archive SAP. En cas d'erreur, <code>SAP_ERROR</code> est retourn&eacute; et <code>sap_errno</code> contient l'un des codes d'erreur suivants:<br>
<code>SAP_ETOOMANY</code> : trop d'archives SAP sont ouvertes simultan&eacute;ment.<br>
<code>SAP_EPERM</code> : impossible de cr&eacute;er le fichier sur le support d'enregistrement.</p>

<h5>Fermeture d'une archive SAP<a name="close_archive"></a></h5>

<p><strong>int sap_CloseArchive(sapID id);</strong><br>
<span style="padding-left:30px"><em>id : identificateur de l'archive SAP</em></span><br><br>
Retourne <code>SAP_OK</code>. En cas d'erreur, <code>SAP_ERROR</code> est retourn&eacute; et <code>sap_errno</code> contient l'un des codes d'erreur suivants:<br>
<code>SAP_EINVAL</code> : le num&eacute;ro d'identification (sapID) est invalide.</p>

<h5>Remplissage une archive SAP<a name="fill_archive"></a></h5>

<p><strong>int sap_FillArchive(sapID id, sapsector_t *sapsector);</strong><br>
<span style="padding-left:30px"><em>id : identificateur de l'archive SAP</em></span><br>
<span style="padding-left:30px"><em>sapsector : pointeur sur la structure de secteur</em></span><br><br>
Cette routine remplie une archive cr&eacute;&eacute;e par sap_CreateArchive() secteur par secteur, en commen&ccedil;ant par le secteur 1 de la piste 0. A chaque appel le num&eacute;ro de secteur est incr&eacute;ment&eacute; de 1 et, si la piste courante devient pleine, la piste suivante est s&eacute;lectionn&eacute;e.<br>
Retourne <code>SAP_OK</code>. En cas d'erreur, <code>SAP_ERROR</code> est retourn&eacute; et <code>sap_errno</code> contient l'un des codes d'erreur suivants:<br>
<code>SAP_EINVAL</code> : le num&eacute;ro d'identification (sapID) est invalide.<br>
<code>SAP_ENOSPC</code> : l'archive SAP est pleine.</p>

<h5>Lecture d'un secteur SAP<a name="read_sector"></a></h5>

<p><strong>int sap_ReadSector(sapID id, int track, int sect, sapsector_t *sapsector);</strong><br>
<span style="padding-left:30px"><em>id : identificateur de l'archive SAP</em></span><br>
<span style="padding-left:30px"><em>track : num&eacute;ro de piste</em></span><br>
<span style="padding-left:30px"><em>sect : num&eacute;ro de secteur</em></span><br>
<span style="padding-left:30px"><em>sapsector : pointeur sur la structure de secteur</em></span><br><br>
Le r&eacute;sultat de la lecture est dans la structure d&eacute;sign&eacute;e par <em>'sapsector'</em>.
Retourne <code>SAP_OK</code> ou une combinaison des flags suivants:<br>
<code>SAP_NO_STD_FMT</code> : le format du secteur est non standard.<br>
<code>SAP_PROTECTED</code> : le secteur est prot&eacute;g&eacute; en &eacute;criture.<br>
<code>SAP_BAD_SECTOR</code> : le secteur a de mauvais identificateurs (piste, secteur)<br>
<code>SAP_CRC_ERROR</code> : erreur de CRC sur les donn&eacute;es du secteur.<br>
En cas d'erreur, <code>SAP_ERROR</code> est retourn&eacute; et <code>sap_errno</code> contient l'un des codes d'erreur suivants:<br>
<code>SAP_EINVAL</code> : le num&eacute;ro d'identification (sapID) est invalide.<br>
<code>SAP_EEMPTY</code> : l'archive SAP est vide.<br>
<code>SAP_EBUSY</code> : l'archive SAP est en train d'&ecirc;tre remplie par sap_FillArchive()</p>

<h5>Lecture d'une s&eacute;rie de secteurs SAP<a name="read_sectors"></a></h5>

<p><strong>int sap_ReadSectorEx(sapID id, int track, int sect, int nsects, unsigned char data[]);</strong><br>
<span style="padding-left:30px"><em>id : identificateur de l'archive SAP</em></span><br>
<span style="padding-left:30px"><em>track : num&eacute;ro de piste de d&eacute;part</em></span><br>
<span style="padding-left:30px"><em>sect : num&eacute;ro de secteur de d&eacute;part</em></span><br>
<span style="padding-left:30px"><em>nsect : nombre de secteurs &agrave; lire</em></span><br>
<span style="padding-left:30px"><em>data : pointeur sur le buffer de secteurs</em></span><br><br>
Retourne <code>SAP_OK</code>. En cas d'erreur, <code>SAP_ERROR</code> est retourn&eacute; et <code>sap_errno</code> contient l'un des codes d'erreur suivants:<br>
<code>SAP_EINVAL</code> : le num&eacute;ro d'identification (sapID) est invalide.<br>
<code>SAP_EEMPTY</code> : l'archive SAP est vide.<br>
<code>SAP_EBUSY</code> : l'archive SAP est en train d'&ecirc;tre remplie par sap_FillArchive()</p>

<h5>Ecriture d'un secteur SAP<a name="write_sector"></a></h5>

<p><strong>int sap_WriteSector(sapID id, int track, int sect, sapsector_t *sapsector);</strong><br>
<span style="padding-left:30px"><em>id : identificateur de l'archive SAP</em></span><br>
<span style="padding-left:30px"><em>track : num&eacute;ro de piste</em></span><br>
<span style="padding-left:30px"><em>sect : num&eacute;ro de secteur</em></span><br>
<span style="padding-left:30px"><em>sapsector : pointeur sur la structure de secteur</em></span><br><br>
Tous les champs du secteur doivent &ecirc;tre sp&eacute;cifi&eacute;s, except&eacute;s les deux champs relatifs au CRC qui seront calcul&eacute;s par la routine elle-m&ecirc;me.<br>
Retourne <code>SAP_OK</code>. En cas d'erreur, <code>SAP_ERROR</code> est retourn&eacute; et <code>sap_errno</code> contient l'un des codes d'erreur suivants:<br>
<code>SAP_EINVAL</code> : le num&eacute;ro d'identification (sapID) est invalide.<br>
<code>SAP_EEMPTY</code> : l'archive SAP est vide.<br>
<code>SAP_EBUSY</code> : l'archive SAP est en train d'&ecirc;tre remplie par sap_FillArchive()</p>

<h5>Ecriture d'une s&eacute;rie de secteurs SAP<a name="write_sectors"></a></h5>

<p><strong>int sap_WriteSectorEx(sapID id, int track, int sect, int nsects, const unsigned char data[]);</strong><br>
<span style="padding-left:30px"><em>id : identificateur de l'archive SAP</em></span><br>
<span style="padding-left:30px"><em>track : num&eacute;ro de piste de d&eacute;part</em></span><br>
<span style="padding-left:30px"><em>sect : num&eacute;ro de secteur de d&eacute;part</em></span><br>
<span style="padding-left:30px"><em>nsect : nombre de secteurs &agrave; &eacute;crire</em></span><br>
<span style="padding-left:30px"><em>data : pointeur sur le buffer de secteurs</em></span><br><br>
Retourne <code>SAP_OK</code>. En cas d'erreur, <code>SAP_ERROR</code> est retourn&eacute; et <code>sap_errno</code> contient l'un des codes d'erreur suivants:<br>
<code>SAP_EINVAL</code> : le num&eacute;ro d'identification (sapID) est invalide.<br>
<code>SAP_EEMPTY</code> : l'archive SAP est vide.<br>
<code>SAP_EBUSY</code> : l'archive SAP est en train d'&ecirc;tre remplie par sap_FillArchive()</p>

<h5>Formatage d'une archive SAP<a name="format_archive"></a></h5>

<p><strong>int sap_FormatArchive(sapID id, int capacity);</strong><br>
<span style="padding-left:30px"><em>id : identificateur de l'archive SAP</em></span><br>
<span style="padding-left:30px"><em>capacity : sap_TRK80 (80 pistes) ou sap_TRK40 (40 pistes)</em></span><br><br>
Retourne <code>SAP_OK</code>. En cas d'erreur, <code>SAP_ERROR</code> est retourn&eacute; et <code>sap_errno</code> contient l'un des codes d'erreur suivants:<br>
<code>SAP_EINVAL</code> : le num&eacute;ro d'identification (sapID) ou le format est invalide.<br>
<code>SAP_EBUSY</code> : l'archive SAP est en train d'&ecirc;tre remplie par sap_FillArchive()</p>

<h5>R&eacute;cup&eacute;ration d'un r&eacute;pertoire SAP<a name="list_archive"></a></h5>

<p><strong>int sap_ListArchive(sapID id, char buffer[], int buffer_size);</strong><br>
<span style="padding-left:30px"><em>id : identificateur de l'archive SAP</em></span><br>
<span style="padding-left:30px"><em>buffer : buffer de r&eacute;pertoire</em></span><br>
<span style="padding-left:30px"><em>buffer_size : taille du buffer de r&eacute;pertoire</em></span><br><br>
Retourne le nombre de lignes de la liste. En cas d'erreur, 0 est retourn&eacute; et <code>sap_errno</code> contient l'un des codes d'erreur suivants:<br>
<code>SAP_EINVAL</code> : le num&eacute;ro d'identification (sapID) est invalide.<br>
<code>SAP_EEMPTY</code> : l'archive SAP est vide.<br>
<code>SAP_EBUSY</code> : l'archive SAP est en train d'&ecirc;tre remplie par sap_FillArchive()</p>

<h5>Ajout d'un fichier &agrave; l'archive SAP<a name="add_file"></a></h5>

<p><strong>int sap_AddFile(sapID id, const char filename[]);</strong><br>
<span style="padding-left:30px"><em>id : identificateur de l'archive SAP</em></span><br>
<span style="padding-left:30px"><em>filename : nom du fichier &agrave; ajouter</em></span><br><br>
Retourne la taille du fichier en octets. En cas d'erreur, 0 est retourn&eacute; et <code>sap_errno</code> contient l'un des codes d'erreur suivants:<br>
<code>SAP_EINVAL</code> : le num&eacute;ro d'identification (sapID) est invalide.<br>
<code>SAP_EEMPTY</code> : l'archive SAP est vide.<br>
<code>SAP_EBUSY</code> : l'archive SAP est en train d'&ecirc;tre remplie par sap_FillArchive()<br>
<code>SAP_ENOENT</code> : le fichier n'existe pas.<br>
<code>SAP_ENFILE</code> : le fichier est vide.<br>
<code>SAP_ENOSPC</code> : le r&eacute;pertoire de l'archive SAP est plein.<br>
<code>SAP_EFBIG</code> : le fichier est trop gros pour l'espace libre de l'archive SAP.</p>

<h5>Effacement de fichier(s) de l'archive SAP<a name="delete_file"></a></h5>

<p><strong>int sap_DeleteFile(sapID id, const char pattern[]);</strong><br>
<span style="padding-left:30px"><em>id : identificateur de l'archive SAP</em></span><br>
<span style="padding-left:30px"><em>pattern : pattern des fichiers &agrave; effacer ('*' et '?' sont support&eacute;s)</em></span><br><br>
Retourne la taille du (des) fichier(s) en octets. En cas d'erreur, 0 est retourn&eacute; et <code>sap_errno</code> contient l'un des codes d'erreur suivants:<br>
<code>SAP_EINVAL</code> : le num&eacute;ro d'identification (sapID) est invalide.<br>
<code>SAP_EEMPTY</code> : l'archive SAP est vide.<br>
<code>SAP_EBUSY</code> : l'archive SAP est en train d'&ecirc;tre remplie par sap_FillArchive()<br>
<code>SAP_ENOENT</code> : le fichier n'existe pas dans l'archive SAP (erreur non valide lorsque <code>pattern</code> contient au moins une wilcard).</p>

<h5>Extraction de fichier(s) de l'archive SAP<a name="extract_file"></a></h5>

<p><strong>int sap_ExtractFile(sapID id, const char pattern[]);</strong><br>
<span style="padding-left:30px"><em>id : identificateur de l'archive SAP</em></span><br>
<span style="padding-left:30px"><em>pattern : pattern des fichiers &agrave; extraire ('*' et '?' sont support&eacute;s)</em></span><br><br>
Retourne la taille du (des) fichier(s) en octets. En cas d'erreur, 0 est retourn&eacute; et <code>sap_errno</code> contient l'un des codes d'erreur suivants:<br>
<code>SAP_EINVAL</code> : le num&eacute;ro d'identification (sapID) est invalide.<br>
<code>SAP_EEMPTY</code> : l'archive SAP est vide.<br>
<code>SAP_EBUSY</code> : l'archive SAP est en train d'&ecirc;tre remplie par sap_FillArchive()<br>
<code>SAP_ENOENT</code> : le fichier n'existe pas dans l'archive SAP (erreur non valide lorsque 'pattern' contient au moins une wilcard).<br>
<code>SAP_EPERM</code> : impossible d'&eacute;crire le ou les fichiers sur le support.</p>

<h5>Lecture des informations de fichier<a name="read_informations"></a></h5>

<p><strong>int sap_GetFileInfo(sapID id, const char filename[], sapfileinfo_t *info);</strong><br>
<span style="padding-left:30px"><em>id : identificateur de l'archive SAP</em></span><br>
<span style="padding-left:30px"><em>filename : nom du fichier &agrave; examiner</em></span><br>
<span style="padding-left:30px"><em>info : pointeur sur la structure d'information</em></span><br><br>
Retourne <code>SAP_OK</code>. En cas d'erreur, <code>SAP_ERROR</code> est retourn&eacute; et <code>sap_errno</code> contient l'un des codes d'erreur suivants:<br>
<code>SAP_EINVAL</code> : le num&eacute;ro d'identification (sapID) est invalide.<br>
<code>SAP_EEMPTY</code> : l'archive SAP est vide.<br>
<code>SAP_EBUSY</code> : l'archive SAP est en train d'&ecirc;tre remplie par sap_FillArchive()<br>
<code>SAP_ENOENT</code> : le fichier n'existe pas dans l'archive SAP.</p>

<hr />

<p><center><p>Teo developers &copy; 1997-2012</p></center></p>

</td></tr></table>
</body>
</html>
