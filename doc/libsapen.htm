<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<title>Teo</title>
<link rel="stylesheet" type="text/css" href="doc.css">
</head>
<body>
<table width="100%"><tr><td>

<p>[<a href="index.htm">Home</a>][<a href="libsapfr.htm">Page en Fran&ccedil;ais</a>]</p>

<h3>LibSAP</h3>

<p>LibSAP is a library for handling SAP archives written in ANSI C. It provides both low-level routines handling SAP archives considered as physical format (disk images) and high-level routines handling SAP archives considered as logic format (compatible with DOS BASIC Thomson).</p>

<ul>
<li><a href="#open_archive">Open a SAP archive</a><br></li>
<li><a href="#create_archive">Create a SAP archive</a><br></li>
<li><a href="#close_archive">Close a SAP archive</a><br></li>
<li><a href="#fill_archive">Fill a SAP archive</a><br></li>
<li><a href="#read_sector">Read a SAP sector</a><br></li>
<li><a href="#read_sectors">Read a range of SAP sectors</a><br></li>
<li><a href="#write_sector">Write a SAP sector</a><br></li>
<li><a href="#write_sectors">Write a range of SAP sectors</a><br></li>
<li><a href="#format_archive">Format a SAP archive</a><br></li>
<li><a href="#list_archive">Store the directory of a SAP archive</a><br></li>
<li><a href="#add_file">Add a file to a SAP archive</a><br></li>
<li><a href="#delete_file">Delete a file in a SAP archive</a><br></li>
<li><a href="#exract_file">Extract a file from a SAP archive</a><br></li>
<li><a href="#read_informations">Get informations of a SAP file</a></li>
</ul>

<h5>Open a SAP archive<a name="open_archive"></a></h5>

<p><strong>sapID sap_OpenArchive(const char filename[], int *format);</strong><br>
<span style="padding-left:30px"><em>filename : name of the SAP archive</em></span><br>
<span style="padding-left:30px"><em>format : return of the archive format (SAP_FORMAT1 or SAP_FORMAT2)</em></span><br><br>
Returns the identifier of the SAP archive. On failure, <code>SAP_ERROR</code> is returned and the <code>sap_errno</code> variable is set to one of the following error codes:<br>
<code>SAP_ETOOMANY</code> : too many SAP archives are opened simultaneously.<br>
<code>SAP_ENOENT</code> : specified SAP archive does not exist.<br>
<code>SAP_EBADF</code> : The specified file is not a SAP archive.</p>

<h5>Create a SAP archive<a name="create_archive"></a></h5>

<p><strong>sapID sap_CreateArchive(const char filename[], int format);</strong><br>
<span style="padding-left:30px"><em>filename : name of the SAP archive</em></span><br>
<span style="padding-left:30px"><em>format : archive format (SAP_FORMAT1 or SAP_FORMAT2)</em></span><br><br>
Returns the identifier of the SAP archive. On failure, <code>SAP_ERROR</code> is returned and the <code>sap_errno</code> variable is set to one of the following error codes:<br>
<code>SAP_ETOOMANY</code> : too many SAP archives are opened simultaneously.<br>
<code>SAP_EPERM</code> : Can not create file on the recording medium.</p>

<h5>Close a SAP archive<a name="close_archive"></a></h5>

<p><strong>int sap_CloseArchive(sapID id);</strong><br>
<span style="padding-left:30px"><em>id : identifier of the SAP archive</em><br><br>
Returns <code>SAP_OK</code>. On failure, <code>SAP_ERROR</code> is returned and the <code>sap_errno</code> variable is set to one of the following error codes:<br>
<code>SAP_EINVAL</code> : SAP archive identifier (SAPID) is invalid.</p>

<h5>Fill a SAP archive<a name="fill_archive"></a></h5>

<p><strong>int sap<em>FillArchive(sapID id, sapsector</em>t *sapsector);</strong><br>
<span style="padding-left:30px"><em>id : identifier of the SAP archive</em></span><br>
<span style="padding-left:30px"><em>sapsector : pointer to a sector structure</em></span><br><br>
Fills an archive created by sap_CreateArchive () sector by sector, starting from sector 1 of track 0. At each call, the sector number is incremented by 1 and, if the current track becomes full, the next track is selected.<br>
Returns <code>SAP_OK</code>. On failure, <code>SAP_ERROR</code> is returned and the <code>sap_errno</code> variable is set to one of the following error codes:<br>
<code>SAP_EINVAL</code> : SAP archive identifier (SAPID) is invalid.<br>
<code>SAP_ENOSPC</code> : SAP archive is full.</p>

<h5>Read a SAP sector<a name="read_sector"></a></h5>

<p><strong>int sap<em>ReadSector(sapID id, int track, int sect, sapsector</em>t *sapsector);</strong><br>
<span style="padding-left:30px"><em>id : identifier of the SAP archive</em></span><br>
<span style="padding-left:30px"><em>track : track number</em></span><br>
<span style="padding-left:30px"><em>sect : sector number</em></span><br>
<span style="padding-left:30px"><em>sapsector : pointer to a sector structure</em></span><br><br>
The result is in the structure <code>sapsector</code>.<br>
Returns <code>SAP_OK flags</code> or a combination of the following codes:<br>
<code>SAP_NO_STD_FMT</code> : the format is non-standard sector.
<code>SAP_PROTECTED</code> : the sector is write protected.
<code>SAP_BAD_SECTOR</code> : the sector has bad identifiers (track, sector)
<code>SAP_CRC_ERROR</code> : CRC error on data sector.
On failure, <code>SAP_ERROR</code> is returned and the <code>sap_errno</code> variable is set to one of the following error codes:<br>  <code>SAP_EINVAL</code> : SAP archive identifier (SAPID) is invalid.<br>
<code>SAP_EEMPTY</code> : SAP archive is empty.<br>
<code>SAP_EBUSY</code> : archive the SAP is being filled by sap_FillArchive ()</p>

<h5>Read a range of SAP sectors<a name="read_sectors"></a></h5>

<p><strong>int sap_ReadSectorEx(sapID id, int track, int sect, int nsects, unsigned char data[]);</strong><br>
<span style="padding-left:30px"><em>id : identifier of the SAP archive</em></span><br>
<span style="padding-left:30px"><em>track : track number to start from</em></span><br>
<span style="padding-left:30px"><em>sect : sector number to start from</em></span><br>
<span style="padding-left:30px"><em>nsect : number of sectors to read</em></span><br>
<span style="padding-left:30px"><em>data : buffer large enough to store sectors</em></span>><br><br>
Returns <code>SAP_OK</code>. On failure, <code>SAP_ERROR</code> is returned and the <code>sap_errno</code> variable is set to one of the following error codes:<br>
<code>SAP_EINVAL</code> : SAP archive identifier (SAPID) is invalid.<br>
<code>SAP_EEMPTY</code> : SAP archive is empty.<br>
<code>SAP_EBUSY</code> : SAP archive is being filled by sap_FillArchive ()</p>

<h5>Write a SAP sector<a name="write_sector"></a></h5>

<p><strong>int sap_WriteSector(sapID id, int track, int sect, sapsector_t *sapsector);</strong><br>
<span style="padding-left:30px"><em>id : identifier of the SAP archive</em></span><br>
<span style="padding-left:30px"><em>track : track number</em></span><br>
<span style="padding-left:30px"><em>sect : sector number</em></span><br>
<span style="padding-left:30px"><em>sapsector : pointer to a sector structure</em></span><br><br>
All fields in the sector must be specified, except the two fields for the CRC which will be calculated by the routine itself.<br>
Returns <code>SAP_OK</code>. On failure, <code>SAP_ERROR</code> is returned and the <code>sap_errno</code> variable is set to one of the following error codes:<br>
<code>SAP_EINVAL</code> : SAP archive identifier (SAPID) is invalid.<br>
<code>SAP_EEMPTY</code> : SAP archive is empty.<br>
<code>SAP_EBUSY</code> : SAP archive is being filled by sap_FillArchive ()</p>

<h5>Write a range of SAP sectors<a name="write_sectors"></a></h5>

<p><strong>int sap_WriteSectorEx(sapID id, int track, int sect, int nsects, const unsigned char data[]);</strong><br>
<span style="padding-left:30px"><em>id : identifier of the SAP archive</em></span><br>
<span style="padding-left:30px"><em>track : track number to start from</em></span><br>
<span style="padding-left:30px"><em>sect : sector number to start from</em></span><br>
<span style="padding-left:30px"><em>nsect : number of sectors to write</em></span><br>
<span style="padding-left:30px"><em>data : buffer of sectors</em></span><br><br>
Returns <code>SAP_OK</code>. On failure, <code>SAP_ERROR</code> is returned and the <code>sap_errno</code> variable is set to one of the following error codes:<br>
<code>SAP_EINVAL</code> : SAP archive identifier (SAPID) is invalid.<br>
<code>SAP_EEMPTY</code> : SAP archive is empty.<br>
<code>SAP_EBUSY</code> : SAP archive is being filled by sap_FillArchive ()</p>

<h5>Format a SAP archive<a name="format_archive"></a></h5>

<p><strong>int sap_FormatArchive(sapID id, int capacity);</strong><br>
<span style="padding-left:30px"><em>id : identifier of the SAP archive</em></span><br><br>
<span style="padding-left:30px"><em>capacity : SAP_TRK80 (80 tracks) or SAP_TRK40 (40 tracks)</em></span><br><br>
Returns <code>SAP_OK</code>. On failure, <code>SAP_ERROR</code> is returned and the <code>sap_errno</code> variable is set to one of the following error codes:<br>
<code>SAP_EINVAL</code> : SAP archive identifier (SAPID) is invalid.<br>
<code>SAP_EBUSY</code> : SAP archive is being filled by sap_FillArchive ()</p>

<h5>Store the directory of a SAP archive<a name="list_archive"></a></h5>

<p><strong>int sap_ListArchive(sapID id, char buffer[], int buffer<em>size);</strong><br>
<span style="padding-left:30px">*id : identifier of the SAP archive*</span><br>
<span style="padding-left:30px">*buffer : buffer for list of files*</span><br>
<span style="padding-left:30px">*buffer</em>size : size of buffer*</span><br><br>
Returns the number of lines of the list. On failure, <code>SAP_ERROR</code> is returned and the <code>sap_errno</code> variable is set to one of the following error codes:<br>
<code>SAP_EINVAL</code> : SAP archive identifier (SAPID) is invalid.<br>
<code>SAP_EEMPTY</code> : SAP archive is empty.<br>
<code>SAP_EBUSY</code> : SAP archive is being filled by sap_FillArchive ()</p>

<h5>Add a file to a SAP archive<a name="add_file"></a></h5>

<p><strong>int sap_AddFile(sapID id, const char filename[]);</strong><br>
<span style="padding-left:30px"><em>id : identifier of the SAP archive</em></span><br>
<span style="padding-left:30px"><em>filename : name of the file to add</em></span><br><br>
Returns the size of the file added in bytes. On failure, <code>SAP_ERROR</code> is returned and the <code>sap_errno</code> variable is set to one of the following error codes:<br>
<code>SAP_EINVAL</code> : SAP archive identifier (SAPID) is invalid.<br>
<code>SAP_EEMPTY</code> : SAP archive is empty.<br>
<code>SAP_EBUSY</code> : SAP archive is being filled by sap_FillArchive ()<br>
<code>SAP_ENOENT</code> : the file does not exist.<br>
<code>SAP_ENFILE</code> : the file is empty.<br>
<code>SAP_ENOSPC</code> : the SAP archive directory is full.<br>
<code>SAP_EFBIG</code> : the file is too big compared with the free space of the SAP archive.</p>

<h5>Delete a file in a SAP archive<a name="delete_file"></a></h5>

<p><strong>int sap_DeleteFile(sapID id, const char pattern[]);</strong><br>
<span style="padding-left:30px"><em>id : identifier of the SAP archive</em></span><br>
<span style="padding-left:30px"><em>pattern : pattern of the file(s) to delete ('*' and '?' are supported)</em></span><br><br>
Returns the size of the file(s) deleted in bytes. On failure, <code>SAP_ERROR</code> is returned and the <code>sap_errno</code> variable is set to one of the following error codes:<br>
<code>SAP_EINVAL</code> : SAP archive identifier (SAPID) is invalid.<br>
<code>SAP_EEMPTY</code> : SAP archive is empty.<br>
<code>SAP_EBUSY</code> : SAP archive is being filled by sap_FillArchive ()<br>
<code>SAP_ENOENT</code> : the file does not exist.</p>

<h5>Extract a file from a SAP archive<a name="exract_file"></a></h5>

<p><strong>int sap_ExtractFile(sapID id, const char pattern[]);</strong><br>
<span style="padding-left:30px"><em>id : identifier of the SAP archive</em></span><br>
<span style="padding-left:30px"><em>pattern : pattern of the file(s) to extract ('*' and '?' are supported)</em></span><br><br>
Returns the size of the file(s) extracted in bytes. On failure, <code>SAP_ERROR</code> is returned and the <code>sap_errno</code> variable is set to one of the following error codes:<br>
<code>SAP_EINVAL</code> : SAP archive identifier (SAPID) is invalid.<br>
<code>SAP_EEMPTY</code> : SAP archive is empty.<br>
<code>SAP_EBUSY</code> : SAP archive is being filled by sap_FillArchive ()<br>
<code>SAP_ENOENT</code> : the file does not exist in the SAP archive (invalid error when <code>pattern</code> contains at least one wildcard).<br>
<code>SAP_EPERM</code> : Can not write the file to the media.</p>

<h5>Get informations of a SAP file<a name="read_informations"></a></h5>

<p><strong>int sap_GetFileInfo(sapID id, const char filename[], sapfileinfo_t *info);</strong><br>
<span style="padding-left:30px"><em>id : identifier of the SAP archive</em></span><br>
<span style="padding-left:30px"><em>filename : name of the file to examine</em></span><br><br>
Returns <code>SAP_OK</code>. On failure, <code>SAP_ERROR</code> is returned and the <code>sap_errno</code> variable is set to one of the following error codes:<br>
<code>SAP_EINVAL</code> : SAP archive identifier (SAPID) is invalid.<br>
<code>SAP_EEMPTY</code> : SAP archive is empty.<br>
<code>SAP_EBUSY</code> : SAP archive is being filled by sap_FillArchive ()<br>
<code>SAP_ENOENT</code> : the file does not exist.</p>

<hr />

<p><center><p>Teo developers &copy; 1997-2012</p></center></p>

</td></tr></table>
</body>
</html>
